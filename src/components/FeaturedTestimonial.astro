---
import type { Testimonial } from '../data/testimonials';

interface Props {
  testimonial: Testimonial;
}

const { testimonial } = Astro.props;

// Convertir texto con saltos de línea en párrafos
const shortParagraphs = testimonial.shortText?.split('\n\n') || [];
const fullParagraphs = testimonial.fullText?.split('\n\n') || [];
---

<div class="relative max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 mb-20">
  <div class="relative group">
    <!-- Badge Destacado -->
    <div id="featured-badge" class="flex justify-center mb-6">
      <div class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-400/20 via-yellow-400/20 to-amber-500/20 backdrop-blur-sm rounded-full font-bold text-sm border-2 border-amber-400/40 shadow-xl">
        <svg class="w-5 h-5 text-amber-500 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
        <span class="text-amber-700 font-black">HISTORIA DE ÉXITO DESTACADA</span>
        <svg class="w-5 h-5 text-amber-500 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
      </div>
    </div>

    <!-- Card Destacada -->
    <div class="relative bg-gradient-to-br from-white via-amber-50/30 to-yellow-50/30 backdrop-blur-sm rounded-3xl p-8 md:p-12 shadow-2xl border-2 border-amber-400/30 hover:border-amber-400/50 transition-all duration-500 hover:shadow-[0_20px_80px_rgba(251,191,36,0.3)] overflow-hidden">
      <!-- Decoración de fondo -->
      <div class="absolute inset-0 opacity-5">
        <div class="absolute -top-20 -right-20 w-80 h-80 bg-amber-400 rounded-full blur-3xl"></div>
        <div class="absolute -bottom-20 -left-20 w-80 h-80 bg-yellow-400 rounded-full blur-3xl"></div>
      </div>

      <!-- Contenido -->
      <div class="relative">
        <!-- Header del testimonio -->
        <div class="flex items-center gap-4 mb-6">
          <div class="w-20 h-20 bg-gradient-to-br from-amber-400 via-yellow-400 to-amber-500 rounded-full flex items-center justify-center text-white font-black text-2xl shadow-2xl border-4 border-white">
            {testimonial.initials}
          </div>
          <div>
            <h3 class="text-2xl md:text-3xl font-black text-[#0f172a]">{testimonial.name}</h3>
            <div class="flex items-center gap-2 text-amber-700 font-bold">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p class="text-base md:text-lg">Paciente desde {testimonial.featuredSince}</p>
            </div>
          </div>
        </div>

        <!-- Quote icon -->
        <div class="mb-4">
          <svg class="w-10 h-10 md:w-12 md:h-12 text-amber-400/40" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
          </svg>
        </div>

        <!-- Texto del testimonio -->
        <div id="featured-testimony" class="prose max-w-none">
          <div id="featured-short" class="text-lg md:text-xl text-[#334155] leading-relaxed space-y-4">
            {shortParagraphs.map((paragraph) => (
              <p>{paragraph}</p>
            ))}
          </div>

          <div id="featured-full" class="hidden text-lg md:text-xl text-[#334155] leading-relaxed space-y-4">
            {fullParagraphs.slice(0, -1).map((paragraph) => (
              <p>{paragraph}</p>
            ))}
            <p class="font-bold text-[#0d4b92] text-xl md:text-2xl">
              {fullParagraphs[fullParagraphs.length - 1]}
            </p>
          </div>
        </div>

        <!-- Botón Leer Más -->
        <div class="mt-8 flex justify-center">
          <button
            id="toggle-featured-btn"
            class="group inline-flex items-center gap-3 bg-gradient-to-r from-amber-400 to-yellow-500 hover:from-amber-500 hover:to-yellow-600 text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-2xl hover:shadow-[0_20px_60px_rgba(251,191,36,0.4)] transition-all duration-300 hover:scale-105"
          >
            <span id="btn-text">Leer Historia Completa</span>
            <svg id="btn-icon" class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleBtn = document.getElementById('toggle-featured-btn');
    const shortText = document.getElementById('featured-short');
    const fullText = document.getElementById('featured-full');
    const btnText = document.getElementById('btn-text');
    const btnIcon = document.getElementById('btn-icon');

    if (!toggleBtn || !shortText || !fullText || !btnText || !btnIcon) return;

    let isExpanded = false;

    toggleBtn.addEventListener('click', () => {
      isExpanded = !isExpanded;

      if (isExpanded) {
        // Mostrar texto completo
        shortText.classList.add('hidden');
        fullText.classList.remove('hidden');
        btnText.textContent = 'Leer Menos';
        btnIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />';
        // NO hacer scroll al expandir
      } else {
        // Mostrar texto corto
        shortText.classList.remove('hidden');
        fullText.classList.add('hidden');
        btnText.textContent = 'Leer Historia Completa';
        btnIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />';
        // NO hacer scroll al colapsar
      }
    });
  });
</script>
